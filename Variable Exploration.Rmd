---
title: "Data exploration"
output: html_document
date: "2023-01-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r cars}
library(tidyverse)
library(dplyr)
library(labelled)
library(janitor)
library(pastecs)
library(haven)

w1_satisfaction_predictors <- haven::read_dta("Data-Stata/our_data/w1_pos_neg_yc_predictors.dta")
```

## Including Plots


```{r pressure, echo=FALSE}
##CLEAN DATA HERE (recode all negative values as NAs)
w1_satisfaction_predictors_clean <- w1_satisfaction_predictors |> 
  select(youthidCUF, number_negative_incoming, number_outgoing_negative, satisfaction, num_bfs, n_mutual_bfs) |> 
  mutate(across(where(is.numeric), ~ case_when(. < 0 ~ NA_real_,
                                                TRUE ~ .)))

ggplot(aes(x = satisfaction), data = w1_satisfaction_predictors_clean)+
  geom_histogram()

ggplot(aes(x = number_negative_incoming), data = w1_satisfaction_predictors_clean)+
  geom_histogram()

ggplot(aes(x = number_outgoing_negative), data = w1_satisfaction_predictors_clean)+
  geom_histogram()

ggplot(aes(x = n_mutual_bfs), data = w1_satisfaction_predictors_clean)+
  geom_histogram()

ggplot(aes(x = num_bfs), data = w1_satisfaction_predictors_clean)+
  geom_histogram()


```


```{r}
ggplot(aes(x = number_negative_incoming, y = satisfaction), data = w1_satisfaction_predictors_clean)+
  stat_summary(fun = "mean", geom = "line")

ggplot(aes(x = number_outgoing_negative, y = satisfaction), data = w1_satisfaction_predictors_clean)+
  stat_summary(fun = "mean", geom = "line")

ggplot(aes(x = num_bfs, y = satisfaction), data = w1_satisfaction_predictors_clean)+
  stat_summary(fun = "mean", geom = "line")

ggplot(aes(x = n_mutual_bfs, y = satisfaction), data = w1_satisfaction_predictors_clean)+
  stat_summary(fun = "mean", geom = "line")

```
```{r}
model_4 <-glm(formula =  satisfaction ~ 1 + num_bfs+n_mutual_bfs+number_outgoing_negative+number_negative_incoming, data = w1_satisfaction_predictors_clean, family = poisson)
summary(model_4)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

### Add positive friendship network measure
```{r}
# import positive network measure
w1_pos_netm <- read.dta13("Data-Stata/our_data/w1_pos_netm.dta",convert.factors =F)
names(w1_pos_netm)[1:2] <- c("youthidCUF","classidCUF")

w1_satisfaction_predictors_clean <- merge(w1_satisfaction_predictors_clean, w1_pos_netm[,1:5], by = "youthidCUF")
```

#### Regression models exploration with positive friendshio network measures
##### Positive Indegree vs. Satisfaction
```{r}
summary(lm(satisfaction ~ indegree, data = w1_satisfaction_predictors_clean))
```

##### Positive Outdegree vs. Satisfaction
```{r}
summary(lm(satisfaction ~ outdegree, data = w1_satisfaction_predictors_clean))
```

##### Positive Isolate vs. Satisfaction
```{r}
summary(lm(satisfaction ~ isolate, data = w1_satisfaction_predictors_clean))
```

##### Do adolescents with smaller networks have worse school satisfaction?
```{r}
summary(lm(satisfaction ~ indegree + outdegree + isolate, data=w1_satisfaction_predictors_clean))
```

##### What if fixed effects classes?
```{r}
w1_satisfaction_predictors_clean$classid.f <- as.factor(w1_satisfaction_predictors_clean$classidCUF)
summary(lm(satisfaction ~ indegree + outdegree + isolate + classid.f, data=w1_satisfaction_predictors_clean))
```

